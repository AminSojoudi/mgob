sudo: required
language: go

go:
  - 1.8.x

services:
  - docker
  - mongodb

before_install:
  - docker pull alpine:edge

before_script:
  - sleep 10
  - >-
    mongo test --eval 'db.test.insert({item: "item", val: "test" });'
  - >-
    mongo test --eval 'db.runCommand({whatsmyuri : 1});'

script:
  - make travis
  - sleep 60
  - docker logs mgob
  - curl http://localhost:8090/version
  - docker logs mgob 2>&1 | grep finished

after_success:
  - make publish

deploy:
  provider: script
  script: make release
  on:
    tags: true
    branch: master